using System.ComponentModel.DataAnnotations;
using System.Collections.Generic;
using PoemApp.Core.Enums;

namespace PoemApp.Core.Entities;

public class Category
{
    public int Id { get; set; }

    [Required]
    [StringLength(50)]
    public string Name { get; set; } = string.Empty; // 可自由输入，如 "小学一年级人教版"

    public string? Description { get; set; }

    // 可选：用于标识分类所属的“维度”或“组”，便于前端分组展示或过滤
    public CategoryGroup? Group { get; set; } // 如 "EducationLevel", "LiteraryForm", "Theme" 等

    // 
    public int? ParentId { get; set; }
    public Category? Parent { get; set; }
    public ICollection<Category> Children { get; set; } = new List<Category>();

    // 关联诗文（多对多）
    public ICollection<PoemCategory> Poems { get; set; } = new List<PoemCategory>();

    // 新增：排序字段（前端按此排序，如朝代按时间顺序、文体按逻辑顺序）
    public int SortOrder { get; set; } = 0;
    //小学从0开始，初中从100开始，高中从200开始
    //文体：诗歌0，
    //古体诗1，  诗经2
    //近体诗10， 五言绝句11，七言绝句12，五言律诗15，七言律诗16，  乐府诗20
    //楚辞25，歌形体26
    //词30， 小令31，中调32，长调33
    //曲40， 散曲41，曲剧42，杂剧43
    //，散文50，先秦散文51，古文52，骈文53，史传散文54，赋55
    //小说200，戏剧300
    // 新增：状态字段（启用/停用，避免删除数据导致关联诗词失效）
    public bool IsEnabled { get; set; } = true;

    // 新增：是否叶子节点（前端渲染菜单时无需递归查询，提升效率）
    public bool IsLeaf { get; set; } = true;
}

// 多对多关系表， 没有额外属性，使用联合主键
public class PoemCategory
{
    public int PoemId { get; set; }
    public Poem Poem { get; set; } = null!;

    public int CategoryId { get; set; }
    public Category Category { get; set; } = null!;
}

/** 分类组枚举，便于前端分组展示或过滤
 * 
 * 
 * 
 * 二、具体优化方案
1. 数据层面：规范分类体系（按组逐一优化）
（1）文体组（LiteraryForm）：明确层级与名称
核心逻辑：按「主干文体→细分文体」二级结构，移除错误 / 冗余分类
| 父分类 | 子分类 | 备注 |
|--------------|---------------------------------|---------------------------------------|
| 诗歌 | 古体诗（四言、五言、七言、杂言）| 包含《诗经》、陶渊明作品等 |
| 诗歌 | 近体诗（五言绝句、七言绝句、五言律诗、七言律诗）| 移除原 “题材组” 的 “绝句”，归入此处 |
| 诗歌 | 乐府诗 | 原 “乐府民歌” 升级为父分类，可包含 “民歌、文人乐府” |
| 词 | 小令、中调、长调 | 保持现有分类，补充子类 |
| 曲 | 散曲（小令、套数）、杂剧 | 明确曲的细分类型 |
| 散文 | 古文、骈文、史传散文、赋 | 补充 “赋”（原缺失），移除 “浑”（错误分类） |
| 先秦散文 | 诸子散文、历史散文 | 原 “诗经” 移出，归入 “诗歌→古体诗” |
（2）题材组（Theme）：按 “通用→细分” 层级优化
核心逻辑：合并语义重叠项，补充二级分类，移除文体混淆项
| 父分类 | 子分类 | 备注 |
|--------------|---------------------------------|---------------------------------------|
| 山水田园 | 山水诗、田园诗、写景诗 | 合并原 “田园诗、写景诗”，归为细分项 |
| 边塞征战 | 边塞诗、征战诗 | 原 “边塞诗” 保留，补充细分 |
| 咏史怀古 | 咏史诗、怀古诗 | 原 “怀古咏史” 拆分，更精准 |
| 情感表达 | 思乡诗、送别诗、闺怨诗、爱情诗 | 合并原 “思乡诗、送别诗、闺怨诗” |
| 咏物抒怀 | 咏物诗、禅意诗、哲理诗 | 原 “咏物诗、禅意诗、哲理诗” 归为一类 |
| 社会现实 | 民生诗、悯农诗、讽喻诗 | 原 “民生诗、悯农诗” 补充 “讽喻诗” |
| 生活情趣 | 童趣诗、题画诗、启蒙诗、劝世诗 | 原 “童趣诗、题画诗” 等归为生活类题材 |
| 叙事抒情 | 叙事诗、抒情诗 | 保留原通用题材，作为父分类 |
（3）风格组（Style）：拆分 “流派” 与 “风格特质”
核心逻辑：新增 “文学流派” 子组（或在 Style 组内分二级），避免维度混杂
| 父分类（风格 / 流派） | 子分类 | 备注 |
|---------------------|---------------------------------|---------------------------------------|
| 文学流派 | 浪漫主义、现实主义 | 原 “浪漫主义 / 现实主义” 归入此类 |
| 风格特质 | 豪放洒脱、婉约含蓄（替换 “含蓄蕴藉”） | 合并语义重叠项，统一名称 |
| 风格特质 | 沉郁顿挫、清新自然、平淡质朴、华丽绮靡 | 补充原缺失的 “平淡质朴、华丽绮靡” |
 */