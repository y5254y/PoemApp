@page "/users/{id:int}"
@using PoemApp.Client.ApiClients
@inject UsersApiClient UsersClient

<h3>用户详情</h3>

@if (user == null)
{
    <p>加载中...</p>
}
else
{
    <h4>基本信息</h4>
    <p>用户名: @user.Username</p>
    <p>注册时间: @user.CreatedAt.ToLocalTime()</p>

    <h4>收藏的古诗文</h4>
    <table class="table">
        <thead>
            <tr>
                <th>标题</th>
                <th>作者</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var favorite in user.Favorites)
            {
                <tr>
                    <td>@favorite.Title</td>
                    <td>@favorite.AuthorName</td>
                </tr>
            }
        </tbody>
    </table>

    <h4>背诵记录</h4>
    <table class="table">
        <thead>
            <tr>
                <th>诗文标题</th>
                <th>状态</th>
                <th>熟练度</th>
                <th>下次复习时间</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var recitation in user.Recitations)
            {
                <tr>
                    <td>@recitation.PoemTitle</td>
                    <td>@recitation.Status</td>
                    <td>@recitation.Proficiency%</td>
                    <td>@recitation.NextReviewTime?.ToLocalTime()</td>
                </tr>
            }
        </tbody>
    </table>

    <h4>成就信息</h4>
    <table class="table">
        <thead>
            <tr>
                <th>成就名称</th>
                <th>达成时间</th>
                <th>奖励状态</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var achievement in user.Achievements)
            {
                <tr>
                    <td>@achievement.AchievementName</td>
                    <td>@achievement.AchievedAt.ToLocalTime()</td>
                    <td>@(achievement.RewardClaimed ? "已领取" : "未领取")</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    [Parameter] public int Id { get; set; }

    private DetailedUserDto? user;

    protected override async Task OnInitializedAsync()
    {
        user = await UsersClient.GetByIdAsync(Id);
    }
}